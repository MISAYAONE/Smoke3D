//--------------------------------------------------------------------------------------
// By Stars XU Tianchen
//--------------------------------------------------------------------------------------

//--------------------------------------------------------------------------------------
// Type definations
//--------------------------------------------------------------------------------------
typedef float3	floatV;
typedef half3	halfV;

#include "CSJacobi3D.hlsli"

//--------------------------------------------------------------------------------------
// Definitions
//--------------------------------------------------------------------------------------
#define	VISCOSITY	0.15

//--------------------------------------------------------------------------------------
// Textures
//--------------------------------------------------------------------------------------
RWTexture3D<halfV>	g_rwUnknown	: register(u0);

//--------------------------------------------------------------------------------------
// Diffusion
//--------------------------------------------------------------------------------------
[numthreads(THREAD_BLOCK_X, THREAD_BLOCK_Y, THREAD_BLOCK_Z)]
void main(uint3 DTid : SV_DispatchThreadID)
{
	// Jacobi iteration
	const half fAlpha = 1.0 / (VISCOSITY * g_fDeltaTime);
	const half fBeta = 6.0 + fAlpha;
	const half2 vf = { fAlpha, fBeta };
	g_rwUnknown[DTid] = Jacobi(vf, DTid);
}
