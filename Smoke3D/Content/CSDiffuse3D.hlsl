//--------------------------------------------------------------------------------------
// By Stars XU Tianchen
//--------------------------------------------------------------------------------------

//--------------------------------------------------------------------------------------
// Type definations
//--------------------------------------------------------------------------------------
typedef float3	floatV;
typedef min16float3	halfV;

#include "CSJacobi3D.hlsli"

//--------------------------------------------------------------------------------------
// Definitions
//--------------------------------------------------------------------------------------
#define	VISCOSITY	0.15

//--------------------------------------------------------------------------------------
// Textures
//--------------------------------------------------------------------------------------
RWTexture3D<halfV>	g_rwUnknown	: register (u0);

//--------------------------------------------------------------------------------------
// Diffusion
//--------------------------------------------------------------------------------------
[numthreads(THREAD_BLOCK_X, THREAD_BLOCK_Y, THREAD_BLOCK_Z)]
void main(uint3 DTid : SV_DispatchThreadID)
{
	// Jacobi iteration
	const min16float fAlpha = 1.0 / (VISCOSITY * min16float(g_fDeltaTime));
	const min16float fBeta = 6.0 + fAlpha;
	const min16float2 vf = { fAlpha, fBeta };
	g_rwUnknown[DTid] = Jacobi(vf, DTid);
}
